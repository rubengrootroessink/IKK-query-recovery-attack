FROM: wal...@Cyveillance.com
SUBJECT: RE: Restoring a corrupt index
DATE: 16 Aug 2004

I fixed my own problem, but hope this might help someone else in the future:

I went into my segments file (with a hex editor), deleted the record for
_cu0v and changed the length 0x20 to be 0x1f, and it seems I have most of my
index back!

Maybe a developer could elaborate on this?

-----Original Message-----
From: wallen@Cyveillance.com [mailto:wallen@Cyveillance.com]
Sent: Monday, August 16, 2004 2:16 PM
To: lucene-user@jakarta.apache.org
Subject: Restoring a corrupt index


Dear fellow Luceners,

I had a disk failure while indexing and am now unable to get ANY of the
documents stored in my index.  I am interested in restoring as many
documents as possible from what is a mostly complete index.

Is there something I can alter by hand to at least get most of the data
back?  I am getting an EOF error on the file/segment _cu0v which was
presumably the file that was being written when the index crashed.  Is there
a reference to that file in segments that I could edit out??

I have included what I hope is useful information below.

Thank you,
Will

--------------------------------------------------------------------


This is the call-stack from an optimize call

			IndexWriter writer = new IndexWriter(path, new
StandardAnalyzer(), false);
------>		writer.optimize();
			logger.debug(writer.docCount() + "");
			writer.close();

------------Call Stack-----------------------
java.io.IOException: read past EOF
	at org.apache.lucene.store.InputStream.refill(InputStream.java:154)
	at org.apache.lucene.store.InputStream.readByte(InputStream.java:43)
	at org.apache.lucene.store.InputStream.readVInt(InputStream.java:83)
	at
org.apache.lucene.index.CompoundFileReader.<init>(CompoundFileReader.java:66
)
	at
org.apache.lucene.index.SegmentReader.initialize(SegmentReader.java:104)
	at
org.apache.lucene.index.SegmentReader.<init>(SegmentReader.java:94)
	at
org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:480)
	at
org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:366)
	at TryStuff.tryFixingLuceneIndex(TryStuff.java:60)
	at TryStuff.main(TryStuff.java:49)

-------------Directory listing-------------

-rw-rw-r--    1 wallen   devs       383461 Jul 27 16:48 _1wtg.cfs
-rw-rw-r--    1 wallen   devs     754131765 Jul 27 21:12 _262q.cfs
-rw-rw-r--    1 wallen   devs     754345785 Jul 29 11:43 _4c49.cfs
-rw-rw-r--    1 wallen   devs     719608798 Jul 31 04:38 _6i6l.cfs
-rw-rw-r--    1 wallen   devs     773242798 Aug  2 03:05 _8o79.cfs
-rw-rw-r--    1 wallen   devs     791843591 Aug  3 12:13 _au8j.cfs
-rw-rw-r--    1 wallen   devs     77665301 Aug  3 14:35 _b21n.cfs
-rw-rw-r--    1 wallen   devs     79123000 Aug  3 17:49 _b9uk.cfs
-rw-rw-r--    1 wallen   devs     71718714 Aug  3 22:05 _bhnf.cfs
-rw-rw-r--    1 wallen   devs     81537292 Aug  4 02:50 _bpga.cfs
-rw-rw-r--    1 wallen   devs     80611946 Aug  4 07:44 _bx95.cfs
-rw-rw-r--    1 wallen   devs     77923836 Aug  4 13:23 _c523.cfs
-rw-rw-r--    1 wallen   devs            0 Aug  4 14:20 _caip.fnm
-rw-rw-r--    1 wallen   devs     79987096 Aug  4 15:29 _ccxt.cfs
-rw-rw-r--    1 wallen   devs     84966054 Aug  4 16:25 _ckqo.cfs
-rw-rw-r--    1 wallen   devs     90829602 Aug  4 19:14 _csjj.cfs
-rw-rw-r--    1 wallen   devs      7486317 Aug  4 19:23 _ctbm.cfs
-rw-rw-r--    1 wallen   devs      1148765 Aug  4 19:24 _ctef.cfs
-rw-rw-r--    1 wallen   devs       958149 Aug  4 19:27 _cth8.cfs
-rw-rw-r--    1 wallen   devs       909911 Aug  4 19:28 _ctk1.cfs
-rw-rw-r--    1 wallen   devs       918952 Aug  4 19:28 _ctmu.cfs
-rw-rw-r--    1 wallen   devs       957856 Aug  4 19:31 _ctpn.cfs
-rw-rw-r--    1 wallen   devs       651717 Aug  4 19:32 _ctsg.cfs
-rw-rw-r--    1 wallen   devs       790354 Aug  4 19:32 _ctv9.cfs
-rw-rw-r--    1 wallen   devs       890058 Aug  4 19:35 _cty2.cfs
-rw-rw-r--    1 wallen   devs            0 Aug  4 19:35 _cu0v.cfs
-rw-rw-r--    1 wallen   devs       891397 Aug  5 13:36 _cu3o.cfs
-rw-rw-r--    1 wallen   devs      1085511 Aug  5 13:40 _cu6h.cfs
-rw-rw-r--    1 wallen   devs       754877 Aug  5 13:40 _cu9b.cfs
-rw-rw-r--    1 wallen   devs      1610682 Aug  5 13:40 _cuc5.cfs
-rw-rw-r--    1 wallen   devs      1039577 Aug  5 13:41 _cuez.cfs
-rw-rw-r--    1 wallen   devs       831174 Aug  5 13:41 _cuht.cfs
-rw-rw-r--    1 wallen   devs       930858 Aug  5 13:56 _cuko.cfs
-rw-rw-r--    1 wallen   devs       911844 Aug  5 13:56 _cuni.cfs
-rw-rw-r--    1 wallen   devs          340 Aug  5 13:56 segments
-rw-rw-r--    1 wallen   devs            4 Aug  5 13:56 deletable
drwxrwxrwx    2 wallen   devs       929792 Aug  5 13:56 .
drwxrwxr-x    5 wallen   devs           40 Aug 10 14:13 ..

---------------------------------------------------------------------
To unsubscribe, e-mail: lucene-user-unsubscribe@jakarta.apache.org
For additional commands, e-mail: lucene-user-help@jakarta.apache.org


---------------------------------------------------------------------
To unsubscribe, e-mail: lucene-user-unsubscribe@jakarta.apache.org
For additional commands, e-mail: lucene-user-help@jakarta.apache.org


