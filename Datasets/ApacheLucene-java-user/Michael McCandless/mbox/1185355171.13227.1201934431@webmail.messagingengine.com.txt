FROM: "Michael McCandless" <luc...@mikemccandless.com>
SUBJECT: Re: Recovering from a Crash
DATE: 25 Jul 2007

"Simon Wistow" <simon@thegestalt.org> wrote:
> We were affected by the great SF outage yesterday and apparently the 
> indexing machine crashed without being shutdown properly.

Eek, sorry!  We are so reliant on electricity these days....
 
> I've taken a backup of the indexes which has the usual smattering of 
> write.lock segments.gen, .cfs, .fdt, .fnm and .fdx etc files and looks 
> to be about the right size.

Hmm, how do you do your backups?   Is there a segments_N file present
in the backup?

It's somewhat spooky that you have a write.lock present because that
means you backed up while a writer was actively writing to the index
which is a bit dangerous because if the timing is unlucky (backup does
an "ls" but before it can copy the segments_N file a commit has
happened) you could fail to copy a segments_N file.  It's best to
either pause the writer for backpus to occur (simplest) or make a
custom deletion policy that safely allows the backup to slowly copy
even while indexing is continuing (advanced).

> However, if I start up my indexer with that directory it shrinks to a 
> fraction of its size (500 times smaller) and (obviously) contains 
> virtually no documents.

It seems like the segments_N file may be missing?

> The data appears to be there - please tell me that I'm doing something 
> stupid and I can recover from this.

Maybe try other (older) backups to see if they have the segments_N file?

Mike

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


