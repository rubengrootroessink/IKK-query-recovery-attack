FROM: Bill Janssen <jans...@parc.com>
SUBJECT: Re: lucene-core-2.2.0.jar broken? CorruptIndexException?
DATE: 29 Nov 2007

> Are you still getting the original exception too or just the Array out =20=
> 
> of bounds one now?  Also, are you doing anything else to the index =20
> while this is happening?  The code at the point in the exception below =20=
> 
> is trying to properly handle deleted documents.

Just the array-out-of-bounds one, now.  The current version of the
code creates a writer, then deletes all old Lucene 'Document'
instances belonging to the specified UpLib doc-id, using that writer,
then re-indexes that UpLib doc-id (which consists of one-to-N Lucene
'Document's).  After doing the six UpLib documents, it calls
optimize().

I'm going back to the old code now.  It uses the 2.0 APIs, so it uses
an IndexReader to delete the existing instances, then closes that
reader (which if I understand it properly should flush the index back
to disk), then creates a new writer to re-index the same documents,
then does the optimize with that writer, which is where the
CorruptIndexException started coming up.  I'm going to run that again
with 2.0, then with last night's build.

I'm not sure if the success with 2.0 meant that a corrupted index
wasn't being detected, or if it wasn't being corrupted in the first
place.

Bill



---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


