FROM: eks dev <eks...@yahoo.co.uk>
SUBJECT: Re: OOM with 2.9
DATE: 12 Jul 2009


-Xms Xms were set to the same value
imo, the problem was to convince OS (Win XP) to map huge continuous block... there were no
jvm processes running at the same time, just this one... but after killing some desktop processes
and restarting machine it worked. 

hmm, 
MMapDirectory has support for chunking (Ineteger.MAX_VALUE) anyhow... maybe for such cases
this threshold can become user settable. I will try to experiment with it  (I am talking about
MMapDirectory -> private final int MAX_BBUF = Integer.MAX_VALUE;)

if that makes sense or not is just another question, using MMAP in such tight memory setup
where something like that has to be done is probably not really justified. On the other hand,
if I have free process memory I would like to use it to the max, it sounds naive to expect,
 this memory can be allocated in one continuous block... 


 

  



----- Original Message ----
> From: Uwe Schindler <uwe@thetaphi.de>
> To: java-user@lucene.apache.org
> Sent: Sunday, 12 July, 2009 15:01:35
> Subject: RE: OOM with 2.9
> 
> > > he/lucene/store/MMapDirectory.html#setUseUnmap(boolean)
> > 
> > 
> > I have tried it already, but it does not help in opening Index... mapping
> > fails
> 
> Various other hints: -Xmx and -Xms should be set to the same value, because
> the mmapped region must map in complete into the available address space. If
> it is fragmented because of resizing of Java Heap it could fail. Also the
> address space for mmapping must be *outside* of -Xmx, because it is not part
> of the Java heap (it is extra). So maybe you should make Xms/Xmx smaller.
> 
> Another problem with mmap (may be different on various operating systems):
> it can be the case that you have already another JVM running in parallel
> (with the old lucene version)? Maybe your operating system is not able to
> map it twice to different addresses or the address space is filled by the
> other JVM (normally every process should have 2 separate Gigabytes of
> address space, but I am not sure).
> 
> > >
> > > A additional possibility is to use the new
> > > org.apache.lucene.store.FileSwitchDirectory
> > this one is nice, will try it
> > 
> > Thanks for tips Uwe.
> 
> Uwe
> 
> 
> 
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
> For additional commands, e-mail: java-user-help@lucene.apache.org



      

---------------------------------------------------------------------
To unsubscribe, e-mail: java-user-unsubscribe@lucene.apache.org
For additional commands, e-mail: java-user-help@lucene.apache.org


